--// Core Services
local Players              = game:GetService("Players")
local RunService           = game:GetService("RunService")
local UserInputService     = game:GetService("UserInputService")
local ReplicatedStorage    = game:GetService("ReplicatedStorage")
local TweenService         = game:GetService("TweenService")
local HttpService          = game:GetService("HttpService")
local TeleportService      = game:GetService("TeleportService")
local Debris               = game:GetService("Debris")
local CoreGui = game:GetService("CoreGui")


--// Client References
local LocalPlayer = Players.LocalPlayer
local Camera      = workspace.CurrentCamera


local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
 

local Window = WindUI:CreateWindow({
    Title = "Quality x Premium [Blockspin]â€‹",
    Icon = "rbxassetid://138614699274576",
    Author = "Quality Dek Gen z eiei",
    Folder = "MySuperHub",
    Size = UDim2.fromOffset(580, 460),
    MinSize = Vector2.new(560, 350),
    MaxSize = Vector2.new(850, 560),
    Transparent = true,
    Theme = "Dark",
    Resizable = true,
    SideBarWidth = 200,
    BackgroundImageTransparency = 0.42,
    HideSearchBar = true,
    ScrollBarEnabled = false,
    User = {
        Enabled = true,
        Anonymous = false,
        Name = LocalPlayer.Name,
        Image = "rbxthumb://type=AvatarHeadShot&id=" .. LocalPlayer.UserId,
        Callback = function() end,
    },
})

Window:EditOpenButton({ Enabled = false })

local ScreenGui = Instance.new("ScreenGui")
local ToggleBtn = Instance.new("ImageButton")

ScreenGui.Name = "WindUI_Toggle"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

ToggleBtn.Size = UDim2.new(0, 50, 0, 50)
ToggleBtn.Position = UDim2.new(0, 20, 0.5, -25)
ToggleBtn.BackgroundTransparency = 1
ToggleBtn.Image = "rbxassetid://138614699274576" 
ToggleBtn.Active = true
ToggleBtn.Draggable = true
ToggleBtn.Parent = ScreenGui

local opened = true

local function toggle()
    opened = not opened
    if Window.UI then
        Window.UI.Enabled = opened
    else
        Window:Toggle()
    end
end

ToggleBtn.MouseButton1Click:Connect(function()
    ToggleBtn:TweenSize(
        UDim2.new(0, 56, 0, 56),
        Enum.EasingDirection.Out,
        Enum.EasingStyle.Quad,
        0.12,
        true,
        function()
            ToggleBtn:TweenSize(
                UDim2.new(0, 50, 0, 50),
                Enum.EasingDirection.Out,
                Enum.EasingStyle.Quad,
                0.12,
                true
            )
        end
    )
    toggle()
end)

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.T then
        toggle()
    end
end)


local CombatTab = Window:Tab({
	Title = "Combat",
	Icon = "swords",
})

local SilentAimEnabled = false
local FOVRadius = 120
local CurrentTarget = nil
local WallbangEnabled = false          -- << NEW
local ShowFOVEnabled = false           -- << NEW

local SilentFOVCircle = Drawing.new("Circle")
SilentFOVCircle.Color = Color3.fromRGB(255, 255, 0)
SilentFOVCircle.Thickness = 1.5
SilentFOVCircle.NumSides = 64
SilentFOVCircle.Filled = false
SilentFOVCircle.Transparency = 1
SilentFOVCircle.Radius = FOVRadius
SilentFOVCircle.Visible = false

local Tracer = Drawing.new("Line")
Tracer.Thickness = 1.5
Tracer.Color = Color3.fromRGB(124, 252, 0)
Tracer.Transparency = 1
Tracer.Visible = false

-- -------------------------------------------------
-- Helper functions (unchanged)
-- -------------------------------------------------
local function getPing()
	local stats = LocalPlayer:FindFirstChild("PlayerGui"):FindFirstChild("NetworkStats")
	if stats then
		local pingText = stats:FindFirstChild("PingLabel")
		if pingText then
			local ping = tonumber(pingText.Text:match("%d+"))
			return ping and ping / 1000 or 0.2
		end
	end
	return 0.2
end

local function getClosestTarget()
	local closest = nil
	local shortestDistance = math.huge
	local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
			local head = player.Character.Head
			local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
			if onScreen then
				local screenPos = Vector2.new(pos.X, pos.Y)
				local distFromCenter = (screenPos - center).Magnitude
				if distFromCenter <= FOVRadius then
					local toTarget = (head.Position - Camera.CFrame.Position).Unit
					local forward = Camera.CFrame.LookVector
					local dot = forward:Dot(toTarget)
					if dot > 0.5 then
						local distance3D = (head.Position - LocalPlayer.Character.Head.Position).Magnitude
						if distance3D < shortestDistance then
							shortestDistance = distance3D
							closest = player
						end
					end
				end
			end
		end
	end
	return closest
end

local function predictPosition(head, hrp)
	local ping = getPing()
	local velocity = hrp and hrp.Velocity or Vector3.zero
	return head.Position + (velocity * ping * 1.15)
end

-- -------------------------------------------------
-- Render loop â€“ now respects the new toggles
-- -------------------------------------------------
RunService.RenderStepped:Connect(function()
    -- FOV circle visibility
	SilentFOVCircle.Visible = SilentAimEnabled and ShowFOVEnabled
	SilentFOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
	SilentFOVCircle.Radius = FOVRadius
	if SilentAimEnabled then
		CurrentTarget = getClosestTarget()
	else
		CurrentTarget = nil
	end
	if CurrentTarget and CurrentTarget.Character and CurrentTarget.Character:FindFirstChild("Head") then
		local targetHead = CurrentTarget.Character.Head
		local myHead = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Head")
		if myHead then
			local myScreenPos, myOnScreen = Camera:WorldToViewportPoint(myHead.Position)
			local targetScreenPos, targetOnScreen = Camera:WorldToViewportPoint(targetHead.Position)
			if myOnScreen and targetOnScreen then
				Tracer.Visible = true
				Tracer.From = Vector2.new(myScreenPos.X, myScreenPos.Y)
				Tracer.To = Vector2.new(targetScreenPos.X, targetScreenPos.Y)
			else
				Tracer.Visible = false
			end
		end
	else
		Tracer.Visible = false
	end
end)

local oldFire
oldFire = hookfunction(game:GetService("ReplicatedStorage").Remotes.Send.FireServer, function(self, ...)
	local args = {
		...
	}
	if SilentAimEnabled and args[2] == "shoot_gun" and CurrentTarget then
		local head = CurrentTarget.Character and CurrentTarget.Character:FindFirstChild("Head")
		local hrp = CurrentTarget.Character and CurrentTarget.Character:FindFirstChild("HumanoidRootPart")
		if head then
			local aimPos = predictPosition(head, hrp)

			args[4] = CFrame.new(LocalPlayer.Character.Head.Position, aimPos)
			args[4] = CFrame.new(math.huge, math.huge, math.huge)
			args[5] = {
				[1] = {
					[1] = {
						["Instance"] = head,
						["Normal"] = Vector3.new(0, 1, 0),
						["Position"] = aimPos
					}
				}
			}

			local beam = Instance.new("Part", workspace)
			beam.Anchored = true
			beam.CanCollide = false
			beam.Size = Vector3.new(0.15, 0.15, (aimPos - LocalPlayer.Character.Head.Position).Magnitude)
			beam.CFrame = CFrame.new(LocalPlayer.Character.Head.Position, aimPos) * CFrame.new(0, 0, -beam.Size.Z / 2)
			beam.Color = Color3.fromRGB(255, 50, 50)
			beam.Material = Enum.Material.Neon
			beam.Transparency = 0.25
			game:GetService("Debris"):AddItem(beam, 0.15)
		end
	end
	return oldFire(self, unpack(args))
end)


-- -------------------------------------------------
-- UI Controls
-- -------------------------------------------------
CombatTab:Toggle({
	Title = "Silent Aim",
	Default = false,
	Callback = function(state)
		SilentAimEnabled = state
	end
})

CombatTab:Toggle({                     -- << NEW
	Title = "Show FOV",
	Default = false,
	Callback = function(state)
		ShowFOVEnabled = state
	end
})

CombatTab:Toggle({                     -- << NEW
	Title = "Super Bullet",
	Default = false,
	Callback = function(state)
		WallbangEnabled = state
	end
})

CombatTab:Slider({
	Title = "Fov Size: ",
	Step = 1,
	Value = {
		Min = 20,
		Max = 1000,
		Default = FOVRadius,
	},
	Callback = function(value)
		FOVRadius = tonumber(value) or 120
	end
})

local Esptab = Window:Tab({
	Title = "esp",
	Icon = "eye",
})

--// ESP NAME TOGGLE (ALL IN ONE)

local ESP_ENABLED = false
local ESP_LIST = {}

local function CreateESP(player)
	if player == game.Players.LocalPlayer then return end

	local function Apply(character)
		if not ESP_ENABLED then return end

		local head = character:WaitForChild("Head", 5)
		if not head then return end

		if head:FindFirstChild("NameESP") then
			head.NameESP:Destroy()
		end

		local gui = Instance.new("BillboardGui")
		gui.Name = "NameESP"
		gui.Adornee = head
		gui.Size = UDim2.new(0, 200, 0, 50)
		gui.StudsOffset = Vector3.new(0, 2.5, 0)
		gui.AlwaysOnTop = true
		gui.MaxDistance = math.huge
		gui.Parent = head

		local text = Instance.new("TextLabel")
		text.Size = UDim2.new(1, 0, 1, 0)
		text.BackgroundTransparency = 1
		text.Text = player.Name
		text.TextSize = 12
		text.TextScaled = false
		text.Font = Enum.Font.SourceSansBold
		text.TextColor3 = Color3.fromRGB(255,255,255)
		text.TextStrokeTransparency = 0
		text.TextStrokeColor3 = Color3.fromRGB(0,0,0)
		text.Parent = gui

		ESP_LIST[player] = gui
	end

	if player.Character then
		Apply(player.Character)
	end

	player.CharacterAdded:Connect(Apply)
end

local function EnableESP()
	for _, plr in ipairs(game.Players:GetPlayers()) do
		CreateESP(plr)
	end
end

local function DisableESP()
	for _, gui in pairs(ESP_LIST) do
		if gui and gui.Parent then
			gui:Destroy()
		end
	end
	table.clear(ESP_LIST)
end


Esptab:Toggle({
	Title = "esp name",
	Default = false,
	Callback = function(v)
		ESP_ENABLED = v
		if v then
			EnableESP()
		else
			DisableESP()
		end
	end
})

Esptab:Toggle({
	Title = 'Inventory Viewer',
	Default = false,
	Callback = function(Value)
		_G.InventoryViewerEnabled = Value
		local Players = game:GetService('Players')
		local ReplicatedStorage = game:GetService('ReplicatedStorage')
		local Client = Players.LocalPlayer
		local function GetColorFromRarity(rarityName)
			local colors = {
				['Common'] = Color3.fromRGB(255, 255, 255),
				['UnCommon'] = Color3.fromRGB(99, 255, 52),
				['Rare'] = Color3.fromRGB(51, 170, 255),
				['Legendary'] = Color3.fromRGB(255, 150, 0),
				['Epic'] = Color3.fromRGB(237, 44, 255),
				['Omega'] = Color3.fromRGB(255, 20, 51),
			}
			return colors[rarityName] or Color3.fromRGB(255, 255, 255)
		end
		if Value then
			if not _G.ViewerRunning then
				_G.ViewerRunning = true
				task.spawn(function()
					while task.wait(0.2) do
						if not _G.InventoryViewerEnabled then
							continue
						end
						pcall(function()
							for _, v in pairs(Players:GetPlayers()) do
								if v ~= Client and v.Character and v.Character:FindFirstChild('HumanoidRootPart') then
									local root = v.Character.HumanoidRootPart
									local gui = root:FindFirstChild('ItemBillboard')
									if not gui then
										gui = Instance.new('BillboardGui')
										gui.Name = 'ItemBillboard'
										gui.AlwaysOnTop = true
										gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
										gui.Size = UDim2.new(0, 200, 0, 50)
										gui.StudsOffset = Vector3.new(0, -5, 0)
										gui.ExtentsOffset = Vector3.new(0, 1, 0)
										gui.LightInfluence = 1
										gui.Parent = root
										local bg = Instance.new('Frame')
										bg.Name = 'BG'
										bg.BackgroundTransparency = 1
										bg.Size = UDim2.new(1, 0, 1, 0)
										bg.AnchorPoint = Vector2.new(0.5, 0.5)
										bg.Position = UDim2.new(0.5, 0, 0.5, 0)
										bg.Parent = gui
										local layout = Instance.new('UIListLayout')
										layout.FillDirection = Enum.FillDirection.Horizontal
										layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
										layout.VerticalAlignment = Enum.VerticalAlignment.Center
										layout.Padding = UDim.new(0, 5)
										layout.Parent = bg
									end
									local bg = gui:FindFirstChild('BG')
									if not bg then
										continue
									end
									local Items = {}

                                    -- à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸‚à¸­à¸‡à¹€à¸à¹ˆà¸²à¸à¹ˆà¸­à¸™
									for _, child in pairs(bg:GetChildren()) do
										if child:IsA('Frame') then
											child:Destroy()
										end
									end

                                    -- loop item à¹ƒà¸™ backpack + character
									for _, container in pairs({
										v:FindFirstChild('Backpack'),
										v.Character
									}) do
										if container then
											for _, tool in pairs(container:GetChildren()) do
												if tool:IsA('Tool') and not tool:GetAttribute('JobTool') and not tool:GetAttribute('Locked') then
													local itemFolder = tool:GetAttribute('AmmoType') and ReplicatedStorage.Items.gun or ReplicatedStorage.Items.melee
													for _, z in pairs(itemFolder:GetChildren()) do
														if tool:GetAttribute('RarityName') == z:GetAttribute('RarityName') and tool:GetAttribute('RarityPrice') == z:GetAttribute('RarityPrice') then
															local imageId = z:GetAttribute('ImageId')
															if imageId then
																Items[z.Name] = true
																if not bg:FindFirstChild(z.Name .. '_bg') then
																	local iconBg = Instance.new('Frame')
																	iconBg.Name = z.Name .. '_bg'
																	iconBg.Size = UDim2.new(0, 34, 0, 34)
																	iconBg.BackgroundColor3 = GetColorFromRarity(z:GetAttribute('RarityName'))
																	iconBg.BackgroundTransparency = 1
																	iconBg.BorderSizePixel = 0
																	iconBg.Parent = bg
																	local bgImage = Instance.new('ImageLabel')
																	bgImage.Name = 'Background'
																	bgImage.Size = UDim2.new(1, 0, 1, 0)
																	bgImage.BackgroundTransparency = 1
																	bgImage.Image = 'rbxassetid://137066731814190'
																	bgImage.ImageColor3 = GetColorFromRarity(z:GetAttribute('RarityName'))
																	bgImage.ZIndex = 0
																	bgImage.Parent = iconBg
																	local corner = Instance.new('UICorner')
																	corner.CornerRadius = UDim.new(0.15, 0)
																	corner.Parent = iconBg
																	local icon = Instance.new('ImageLabel')
																	icon.Name = z.Name
																	icon.Image = imageId
																	icon.BackgroundTransparency = 1
																	icon.BorderSizePixel = 0
																	icon.Size = UDim2.new(0.85, 0, 0.85, 0)
																	icon.Position = UDim2.new(0.075, 0, 0.075, 0)
																	icon.Parent = iconBg
																	local corner2 = Instance.new('UICorner')
																	corner2.CornerRadius = UDim.new(0, 9)
																	corner2.Parent = icon
																end
															end
														end
													end
												end
											end
										end
									end
									gui.Enabled = _G.InventoryViewerEnabled
									for _, child in pairs(bg:GetChildren()) do
										if child:IsA('Frame') then
											local itemName = child.Name:gsub('_bg$', '')
											if not Items[itemName] then
												child:Destroy()
											end
										end
									end
								end
							end
						end)
					end
				end)
			end
		else
            -- à¸¥à¸š GUI à¹€à¸¡à¸·à¹ˆà¸­à¸›à¸´à¸”
			for _, v in pairs(Players:GetPlayers()) do
				if v.Character and v.Character:FindFirstChild('HumanoidRootPart') then
					local gui = v.Character.HumanoidRootPart:FindFirstChild('ItemBillboard')
					if gui then
						gui:Destroy()
					end
				end
			end
		end
	end  -- à¸›à¸´à¸” Callback function
})  -- à¸›à¸´à¸” table à¸‚à¸­à¸‡ Toggle

local PlayerTab = Window:Tab({
	Title = "Player",
	Icon = "user",
})


local Players = game:GetService("Players")
local Player = Players.LocalPlayer

-- à¸›à¸£à¸°à¸à¸²à¸¨à¸•à¸±à¸§à¹à¸›à¸£à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹„à¸§à¹‰à¸‚à¹‰à¸²à¸‡à¸™à¸­à¸
local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid
local RootPart

-- à¸•à¸±à¸§à¹à¸›à¸£à¸„à¸§à¸šà¸„à¸¸à¸¡
local EnabledSpeed = false
local SpeedValue = 16

-- Function à¸ªà¸³à¸«à¸£à¸±à¸š setup character
local function SetupCharacter(char)
	Character = char
	Humanoid = char:WaitForChild('Humanoid')
	RootPart = char:WaitForChild('HumanoidRootPart')
	
	-- à¸£à¸µà¹€à¸‹à¹‡à¸•à¸„à¹ˆà¸²à¹€à¸¡à¸·à¹ˆà¸­ spawn à¹ƒà¸«à¸¡à¹ˆ
	if EnabledSpeed then
		Humanoid.WalkSpeed = SpeedValue
	end
end

-- à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸„à¸£à¸±à¹‰à¸‡à¹€à¸”à¸µà¸¢à¸§
Player.CharacterAdded:Connect(SetupCharacter)

-- Setup à¸•à¸±à¸§à¸¥à¸°à¸„à¸£à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¸–à¹‰à¸²à¸¡à¸µ)
if Player.Character then
	SetupCharacter(Player.Character)
end

-- Loop à¸­à¸±à¸›à¹€à¸”à¸•à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§
task.spawn(function()
	while task.wait(0.05) do -- à¸¥à¸”à¹€à¸§à¸¥à¸²à¸£à¸­à¹ƒà¸«à¹‰à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™
		if Humanoid and EnabledSpeed then
			Humanoid.WalkSpeed = SpeedValue
		end
	end
end)

-- Toggles & Sliders
PlayerTab:Toggle({
	Title = 'Walk Speed',
	Icon = 'check',
	Type = 'Checkbox',
	Value = false,
	Callback = function(Value)
		EnabledSpeed = Value
		if Humanoid then
			Humanoid.WalkSpeed = Value and SpeedValue or 16
		end
	end,
})

PlayerTab:Slider({
	Title = 'Speed Value',
	Step = 1,
	Value = {
		Min = 8,
		Max = 35,
		Default = 16
	},
	Callback = function(Value)
		SpeedValue = Value
		if Humanoid and EnabledSpeed then
			Humanoid.WalkSpeed = Value
		end
	end,
})
-- ðŸ”¹ à¸•à¸±à¸§à¹à¸›à¸£à¹€à¸à¹‡à¸šà¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¹€à¸›à¸´à¸” Fly Jump
local EnabledFlyJump = false

PlayerTab:Toggle({
	Title = 'Fly Jump',
	Type = 'Checkbox',
	Value = false,
	Callback = function(Value)
		EnabledFlyJump = Value
	end,
})

-- ðŸ”¹ Event à¸à¸” Space (à¸à¸£à¸°à¹‚à¸”à¸”)
UserInputService.JumpRequest:Connect(function()
	if not EnabledFlyJump or not RootPart then
		return
	end
	holdingJump = true
	task.spawn(function()
		while holdingJump and EnabledFlyJump do
			RunService.Heartbeat:Wait()
			if RootPart then
				RootPart.Velocity =
                    Vector3.new(RootPart.Velocity.X, 30, RootPart.Velocity.Z)
			else
				break
			end
		end
	end)
end)

-- ðŸ”¹ Event à¸›à¸¥à¹ˆà¸­à¸¢à¸›à¸¸à¹ˆà¸¡ Space (à¸«à¸¢à¸¸à¸”à¸šà¸´à¸™à¸‚à¸¶à¹‰à¸™)
UserInputService.InputEnded:Connect(function(input)
	if input.KeyCode == Enum.KeyCode.Space then
		holdingJump = false
	end
end)

-- à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸•à¸±à¸§à¹à¸›à¸£à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™
EnabledInfiniteStamina = false

-- à¸ªà¸£à¹‰à¸²à¸‡ toggle à¸šà¸™à¹€à¸¡à¸™à¸¹
PlayerTab:Toggle({
	Title = 'Infinite Stamina',
	Type = 'Checkbox',
	Value = false,
	Callback = function(Value)
		EnabledInfiniteStamina = Value
	end,
})

-- à¹€à¸à¹‡à¸šà¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸”à¸´à¸¡à¸‚à¸­à¸‡ SprintBar.update à¹„à¸§à¹‰
local OldUpdate = SprintBar.update

-- à¹€à¸‚à¸µà¸¢à¸™à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹ƒà¸«à¸¡à¹ˆà¹à¸—à¸™à¸—à¸µà¹ˆ
SprintBar.update = function(...)
	if EnabledInfiniteStamina then
        -- à¸–à¹‰à¸²à¹€à¸›à¸´à¸”à¹‚à¸«à¸¡à¸” Infinite Stamina à¹ƒà¸«à¹‰à¸„à¸·à¸™à¸„à¹ˆà¸²à¹€à¸•à¹‡à¸¡ (1)
		return 1
	else
        -- à¸–à¹‰à¸²à¸›à¸´à¸” à¹ƒà¸«à¹‰à¸—à¸³à¸‡à¸²à¸™à¸•à¸²à¸¡à¸›à¸à¸•à¸´
		return OldUpdate(...)
	end
end
